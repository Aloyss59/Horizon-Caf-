<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Horizon Café - Chat</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="/css/responsive.css">
<script src="../js/auth-guard.js" defer></script>
<script src="../js/common.js" defer></script>

<style>
/* RESET & BASE - DARK MODE INDUSTRIEL */
*{margin:0;padding:0;box-sizing:border-box;font-family:'Montserrat','Roboto',sans-serif;}
@import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&family=Roboto:wght@400;500;700&display=swap');

body{background:#1a1a1a;color:#e0e0e0;line-height:1.5;}
h1,h2,h3,h4,h5{font-weight:700;color:#ffffff;}
p{font-size:0.9rem;color:#b0b0b0;}
a{text-decoration:none;color:inherit;}

/* NAVBAR - EFFET NEON */
.navbar{width:100%;background:#0a0a0a;padding:0.8rem 2rem;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:1000;box-shadow:0 0 30px rgba(0,210,255,0.3), 0 4px 12px rgba(0,0,0,0.8);border-bottom:2px solid #00d2ff;}
.navbar .logo h2{color:#ffffff;font-size:1.5rem;font-weight:800;font-family:'Montserrat',sans-serif;text-shadow:0 0 10px #00d2ff, 0 0 20px #00d2ff, 0 0 30px #0099cc;letter-spacing:2px;}
.navbar .nav-links{list-style:none;display:flex;gap:1rem;align-items:center;margin-left:2rem;}
.navbar .nav-link{display:flex;align-items:center;gap:0.25rem;padding:0.5rem 0.75rem;border-radius:4px;color:#e0e0e0;}
.navbar .nav-link:hover,.navbar .nav-link.active{background:rgba(100,100,100,0.2);color:#e0e0e0;}
.navbar .user-section{display:flex;align-items:center;gap:0.5rem;margin-left:auto;color:#e0e0e0;}
.btn-logout{background:#4a4a4a;color:#e0e0e0;border:none;padding:0.4rem 0.8rem;border-radius:4px;cursor:pointer;display:flex;align-items:center;gap:0.25rem;transition:all 0.3s;font-weight:bold;}
.btn-logout:hover{background:#6a6a6a;transform:translateY(-2px);}
.user-name-link{cursor:pointer;padding:0.5rem 1rem;border-radius:4px;transition:all 0.3s;font-weight:600;display:flex;align-items:center;gap:0.5rem;}
.user-name-link:hover{background:rgba(0,210,255,0.2);color:#00d2ff;}
.btn-theme-toggle{background:transparent;border:2px solid #00d2ff;color:#00d2ff;padding:0.6rem 0.9rem;border-radius:6px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:transform 0.3s ease, box-shadow 0.3s ease;font-size:1.1rem;margin-right:1rem;position:relative;overflow:hidden;box-shadow:0 0 10px rgba(0,210,255,0.3);}
.btn-theme-toggle::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(0,210,255,0.3),transparent);transition:left 0.5s;}
.btn-theme-toggle:hover::before{left:100%;}
.btn-theme-toggle:hover{background:rgba(0,210,255,0.15);transform:scale(1.15);box-shadow:0 0 20px rgba(0,210,255,0.6);text-shadow:0 0 10px rgba(0,210,255,0.8);}

/* CHAT LAYOUT */
.chat-container{display:flex;max-width:1400px;margin:2rem auto;height:calc(100vh - 100px);gap:1rem;padding:0 1rem;}
.chat-sidebar{width:300px;background:#0f0f0f;border-radius:12px;box-shadow:0 0 20px rgba(0,210,255,0.1);display:flex;flex-direction:column;border:1px solid #2a2a2a;}
.sidebar-header{padding:1rem;border-bottom:1px solid #2a2a2a;display:flex;justify-content:space-between;align-items:center;}
.sidebar-header h2{color:#00d2ff;font-size:1.25rem;text-shadow:0 0 10px rgba(0,210,255,0.3);}
.btn-new-chat{background:#00d2ff;color:#000;border:none;padding:0.4rem 0.6rem;border-radius:6px;cursor:pointer;font-weight:700;transition:all 0.3s;box-shadow:0 0 10px rgba(0,210,255,0.3);}
.btn-new-chat:hover{background:#00ffff;box-shadow:0 0 20px rgba(0,210,255,0.6);transform:scale(1.1);}
.chat-tabs{display:flex;border-bottom:1px solid #2a2a2a;}
.tab-btn{flex:1;padding:0.5rem;cursor:pointer;text-align:center;font-weight:600;color:#888;transition:all 0.3s;background:#0a0a0a;border:none;}
.tab-btn.active{background:#00d2ff;color:#000;font-weight:700;}
.chat-list{flex:1;overflow-y:auto;}
.chat-item{display:flex;gap:0.5rem;padding:0.75rem;cursor:pointer;align-items:center;transition:all 0.3s;border-radius:8px;margin:0.25rem;}
.chat-item:hover,.chat-item.active{background:rgba(0,210,255,0.2);border-left:3px solid #00d2ff;}
.avatar{width:40px;height:40px;background:#2a5f7f;color:#00d2ff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:0.85rem;box-shadow:0 0 10px rgba(0,210,255,0.2);}
.avatar.group{background:#5f3f7f;color:#d4a5ff;}
.chat-info h4{font-size:0.95rem;font-weight:600;color:#ffffff;}
.chat-info p{font-size:0.8rem;color:#888;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:180px;}

/* MAIN CHAT AREA */
.chat-main{flex:1;display:flex;flex-direction:column;background:#0f0f0f;border-radius:12px;box-shadow:0 0 20px rgba(0,210,255,0.1);border:1px solid #2a2a2a;}
.chat-window{flex:1;padding:1rem;overflow-y:auto;display:flex;flex-direction:column;gap:0.75rem;}
.message{padding:0.75rem 1rem;border-radius:12px;max-width:70%;word-wrap:break-word;font-size:0.9rem;}
.message.user{align-self:flex-end;background:#2a5f7f;color:#e0e0e0;border:1px solid #00d2ff;box-shadow:0 0 10px rgba(0,210,255,0.2);}
.message.bot{align-self:flex-start;background:#1a1a1a;color:#b0b0b0;border:1px solid #2a2a2a;}
.chat-input-area{display:flex;padding:1rem;border-top:1px solid #2a2a2a;gap:0.5rem;}
.message-input{flex:1;padding:0.6rem 1rem;border-radius:8px;border:1px solid #2a2a2a;background:#0a0a0a;color:#e0e0e0;}
.message-input::placeholder{color:#666;}
.btn-send{padding:0.6rem 1rem;border:none;border-radius:8px;background:#00d2ff;color:#000;cursor:pointer;transition:all 0.3s;font-weight:700;box-shadow:0 0 10px rgba(0,210,255,0.3);}
.btn-send:hover{background:#00ffff;transform:scale(1.05);box-shadow:0 0 20px rgba(0,210,255,0.6);}

/* MODE CLAIR */
body.light-mode{background:#fafaf8;color:#2c2c2c;}
body.light-mode h1,body.light-mode h2,body.light-mode h3,body.light-mode h4,body.light-mode h5{color:#1a1a1a;}
body.light-mode p{color:#555555;}
body.light-mode a{color:#2c2c2c;}
body.light-mode .navbar{background:linear-gradient(135deg,#ffffff 0%,#f9f6f3 100%);border-bottom:3px solid #ff6b4a;box-shadow:0 0 25px rgba(255,107,74,0.2), 0 4px 15px rgba(0,0,0,0.08);}
body.light-mode .navbar .logo h2{color:#ff6b4a;text-shadow:0 0 15px rgba(255,107,74,0.3);letter-spacing:2px;font-weight:900;}
body.light-mode .navbar .nav-links{border-left:2px solid #ffd4a0;padding-left:1.5rem;}
body.light-mode .navbar .nav-link{color:#2c2c2c;font-weight:600;}
body.light-mode .navbar .nav-link:hover,body.light-mode .navbar .nav-link.active{background:rgba(255,107,74,0.08);color:#ff6b4a;border-radius:6px;box-shadow:0 0 10px rgba(255,107,74,0.15);}
body.light-mode .btn-theme-toggle{border-color:#ff9b7a;color:#ff6b4a;background:rgba(255,107,74,0.05);box-shadow:0 0 10px rgba(255,107,74,0.2);}
body.light-mode .btn-theme-toggle:hover{border-color:#ff6b4a;background:rgba(255,107,74,0.1);box-shadow:0 0 20px rgba(255,107,74,0.4);}
body.light-mode .btn-logout{background:#ff9b7a;color:#ffffff;font-weight:700;border:none;}
body.light-mode .btn-logout:hover{background:#ff6b4a;box-shadow:0 0 15px rgba(255,107,74,0.4);}
body.light-mode .user-name-link:hover{background:rgba(255,107,74,0.1);color:#ff6b4a;}
body.light-mode .user-section{color:#2c2c2c;font-weight:600;}
body.light-mode .chat-container{padding:0 1rem;}
body.light-mode .chat-sidebar{background:#ffffff;border:2px solid #ffd4a0;box-shadow:0 0 15px rgba(255,107,74,0.1);}
body.light-mode .sidebar-header{border-bottom-color:#ffd4a0;}
body.light-mode .sidebar-header h2{color:#ff6b4a;text-shadow:0 0 10px rgba(255,107,74,0.2);}
body.light-mode .btn-new-chat{background:#ff6b4a;color:#ffffff;box-shadow:0 0 10px rgba(255,107,74,0.2);}
body.light-mode .btn-new-chat:hover{background:#ff4a20;box-shadow:0 0 20px rgba(255,107,74,0.5);}
body.light-mode .chat-tabs{border-bottom-color:#ffd4a0;}
body.light-mode .tab-btn{background:#f9f9f9;color:#555;}
body.light-mode .tab-btn.active{background:#ff6b4a;color:#ffffff;}
body.light-mode .chat-item{margin:0.25rem;}
body.light-mode .chat-item:hover,body.light-mode .chat-item.active{background:rgba(255,107,74,0.1);border-left-color:#ff6b4a;}
body.light-mode .avatar{background:#ffb399;color:#ffffff;box-shadow:0 0 10px rgba(255,107,74,0.2);}
body.light-mode .avatar.group{background:#ffb399;color:#ffffff;}
body.light-mode .chat-info h4{color:#1a1a1a;}
body.light-mode .chat-info p{color:#555;}
body.light-mode .chat-list{border-right:1px solid #ffd4a0;}
body.light-mode .chat-main{background:#ffffff;border:2px solid #ffd4a0;box-shadow:0 0 15px rgba(255,107,74,0.1);}
body.light-mode .message.user{background:#ffb399;color:#ffffff;border-color:#ff6b4a;box-shadow:0 0 10px rgba(255,107,74,0.2);}
body.light-mode .message.bot{background:#f9f9f9;color:#555;border-color:#ffd4a0;}
body.light-mode .chat-input-area{border-top-color:#ffd4a0;}
body.light-mode .message-input{background:#ffffff;border-color:#ffd4a0;color:#2c2c2c;}
body.light-mode .message-input::placeholder{color:#999;}
body.light-mode .btn-send{background:#ff6b4a;color:#ffffff;box-shadow:0 0 10px rgba(255,107,74,0.2);}
body.light-mode .btn-send:hover{background:#ff4a20;box-shadow:0 0 20px rgba(255,107,74,0.5);}

/* MODAL CRÉATION */
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);z-index:2000;justify-content:center;align-items:center;}
.modal.active{display:flex;}
.modal-content{background:#0f0f0f;border-radius:12px;padding:2rem;width:90%;max-width:500px;border:2px solid #00d2ff;box-shadow:0 0 30px rgba(0,210,255,0.3);}
.modal-header{font-size:1.5rem;font-weight:700;color:#00d2ff;margin-bottom:1.5rem;display:flex;justify-content:space-between;align-items:center;}
.btn-close-modal{background:transparent;border:none;color:#00d2ff;font-size:1.5rem;cursor:pointer;}
.modal-tabs{display:flex;gap:1rem;margin-bottom:1.5rem;}
.modal-tab{flex:1;padding:0.8rem;text-align:center;border:2px solid #2a2a2a;background:#0a0a0a;color:#888;cursor:pointer;transition:all 0.3s;border-radius:6px;font-weight:600;}
.modal-tab.active{border-color:#00d2ff;color:#00d2ff;background:rgba(0,210,255,0.1);}
.modal-section{display:none;}
.modal-section.active{display:block;}
.search-input{width:100%;padding:0.8rem;background:#0a0a0a;border:1px solid #2a2a2a;border-radius:6px;color:#e0e0e0;margin-bottom:1rem;}
.search-input::placeholder{color:#666;}
.user-list{max-height:300px;overflow-y:auto;border:1px solid #2a2a2a;border-radius:6px;background:#0a0a0a;}
.user-item,.group-item{padding:0.75rem;border-bottom:1px solid #2a2a2a;cursor:pointer;display:flex;align-items:center;gap:0.5rem;transition:all 0.3s;}
.user-item:hover,.group-item:hover{background:rgba(0,210,255,0.1);}
.user-item input[type="checkbox"],.group-item input[type="checkbox"]{width:18px;height:18px;cursor:pointer;}
.user-item label,.group-item label{flex:1;cursor:pointer;padding:0.5rem 0;margin:0;}
.group-name-input{width:100%;padding:0.8rem;background:#0a0a0a;border:1px solid #2a2a2a;border-radius:6px;color:#e0e0e0;margin-bottom:1rem;margin-top:1rem;}
.modal-actions{display:flex;gap:0.5rem;margin-top:1.5rem;}
.btn-create{flex:1;padding:0.8rem;background:#00d2ff;color:#000;border:none;border-radius:6px;font-weight:700;cursor:pointer;transition:all 0.3s;}
.btn-create:hover{background:#00ffff;transform:scale(1.05);}
.btn-cancel{flex:1;padding:0.8rem;background:#2a2a2a;color:#e0e0e0;border:none;border-radius:6px;font-weight:600;cursor:pointer;transition:all 0.3s;}
.btn-cancel:hover{background:#3a3a3a;}
.selected-count{font-size:0.85rem;color:#888;margin-top:0.5rem;}

/* FOOTER */
footer{background:#0a0a0a;color:#888;padding:2rem;text-align:center;border-top:2px solid #00d2ff;box-shadow:0 0 20px rgba(0,210,255,0.2);margin-top:3rem;font-size:0.9rem;}
footer p{color:#888;margin:0;}
footer i{color:#00d2ff;}
body.light-mode footer{background:#ffffff;border-top-color:#ff6b4a;color:#555;}
body.light-mode footer i{color:#ff6b4a;}

body.light-mode .modal-content{background:#ffffff;border-color:#ff6b4a;box-shadow:0 0 30px rgba(255,107,74,0.3);}
body.light-mode .modal-header{color:#ff6b4a;}
body.light-mode .btn-close-modal{color:#ff6b4a;}
body.light-mode .modal-tab{border-color:#ffd4a0;background:#f9f9f9;color:#555;}
body.light-mode .modal-tab.active{border-color:#ff6b4a;color:#ff6b4a;background:rgba(255,107,74,0.1);}
body.light-mode .search-input{background:#f9f9f9;border-color:#ffd4a0;color:#2c2c2c;}
body.light-mode .search-input::placeholder{color:#999;}
body.light-mode .user-list{border-color:#ffd4a0;background:#f9f9f9;}
body.light-mode .user-item,body.light-mode .group-item{border-color:#ffd4a0;}
body.light-mode .user-item:hover,body.light-mode .group-item:hover{background:rgba(255,107,74,0.1);}
body.light-mode .group-name-input{background:#f9f9f9;border-color:#ffd4a0;color:#2c2c2c;}
body.light-mode .btn-create{background:#ff6b4a;color:#ffffff;}
body.light-mode .btn-create:hover{background:#ff4a20;}
body.light-mode .btn-cancel{background:#ffd4a0;color:#2c2c2c;}
body.light-mode .btn-cancel:hover{background:#ffb399;}
body.light-mode .selected-count{color:#555;}

@media(max-width:768px){
    /* NAVBAR MOBILE */
    .navbar{padding:0.5rem 1rem;flex-wrap:wrap;}
    .navbar .logo h2{font-size:1.2rem;}
    .navbar .nav-links{position:absolute;top:100%;left:0;width:100%;flex-direction:column;background:#0a0a0a;display:none;border-top:2px solid #00d2ff;}
    .navbar .nav-links.show{display:flex !important;}
    .navbar .nav-link{width:100%;padding:0.75rem 1rem !important;border-radius:0;border-bottom:1px solid #2a2a2a;}
    .btn-menu-toggle{display:flex !important;flex-direction:column;gap:4px;background:none;border:none;color:#00d2ff;cursor:pointer;padding:0.5rem;}
    .btn-menu-toggle span{width:20px;height:2px;background:#00d2ff;transition:all 0.3s;}
    .btn-menu-toggle.active span:nth-child(1){transform:rotate(45deg) translate(8px, 8px);}
    .btn-menu-toggle.active span:nth-child(2){opacity:0;}
    .btn-menu-toggle.active span:nth-child(3){transform:rotate(-45deg) translate(7px, -7px);}
    .btn-theme-toggle{margin-right:0.5rem;padding:0.4rem 0.6rem;font-size:0.9rem;}
    .user-section{flex-direction:column;gap:0.25rem;margin-left:auto;font-size:0.85rem;}
    .user-name-link{padding:0.25rem 0.5rem;}
    .btn-logout{padding:0.3rem 0.6rem;font-size:0.8rem;}
    
    /* CHAT LAYOUT MOBILE */
    .chat-container{flex-direction:column;height:auto;margin:0;padding:0;}
    .chat-sidebar{width:100%;height:auto;order:2;border-radius:0;margin-top:1rem;}
    .chat-main{order:1;height:300px;border-radius:0;margin:1rem 0 0 0;}
    .chat-window{padding:0.5rem;}
    .message{max-width:90%;}
    .chat-input-area{padding:0.5rem;}
    .message-input{padding:0.5rem;}
}

@media(max-width:480px){
    .navbar .logo h2{font-size:1rem;}
    .navbar{padding:0.4rem 0.5rem;}
    .chat-main{height:250px;}
    .message{font-size:0.85rem;padding:0.5rem 0.75rem;}
    .sidebar-header h2{font-size:1rem;}
}
</style>
</head>
<body>

<nav class="navbar">
    <div class="logo"><h2>Horizon Café</h2></div>
    <button class="btn-menu-toggle" id="btnMenuToggle" onclick="toggleMobileMenu()"></button>
    <ul class="nav-links" id="navLinks">
        <li><a href="./home.html" class="nav-link"><i class="fas fa-home"></i> Accueil</a></li>
        <li><a href="./menu.html" class="nav-link"><i class="fas fa-utensils"></i> Menu</a></li>
        <li><a href="./schedule.html" class="nav-link"><i class="fas fa-calendar"></i> Emploi du Temps</a></li>
        <li><a href="./chat.html" class="nav-link active"><i class="fas fa-comments"></i> Chat</a></li>
    </ul>
    <button class="btn-theme-toggle" id="themeToggle" title="Basculer le mode">
        <i class="fas fa-moon"></i>
    </button>
    <div class="user-section">
        <span class="user-name-link" onclick="goToProfile()" title="Voir mon profil"><i class="fas fa-user-circle"></i> <span id="userGreeting">Jean Dupont</span></span>
        <button class="btn-logout" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Déconnexion</button>
    </div>
</nav>

<div class="chat-container">
    <div class="chat-sidebar">
        <div class="sidebar-header">
            <h2>Discussions</h2>
            <button class="btn-new-chat" onclick="createNewChat()"><i class="fas fa-plus"></i></button>
        </div>

        <div class="chat-tabs">
            <button class="tab-btn active" onclick="switchChatType('direct', event)">Messages</button>
            <button class="tab-btn" onclick="switchChatType('groups', event)">Groupes</button>
        </div>

        <div id="direct" class="chat-list">
            <!-- Les conversations s'ajoutent ici -->
        </div>

        <div id="groups" class="chat-list" style="display:none;">
            <!-- Les groupes s'ajoutent ici -->
        </div>
    </div>

    <div class="chat-main">
        <div class="chat-window" id="chatWindow">
            <div class="message bot">Bienvenue dans la conversation. Sélectionnez un chat.</div>
        </div>
        <div class="chat-input-area">
            <input type="text" id="chatInput" class="message-input" placeholder="Ecrivez un message...">
            <button class="btn-send" onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>
</div>

<!-- MODAL CRÉATION CONVERSATION -->
<div class="modal" id="createChatModal">
    <div class="modal-content">
        <div class="modal-header">
            <span>Nouvelle Conversation</span>
            <button class="btn-close-modal" onclick="closeModal()">&times;</button>
        </div>

        <div class="modal-tabs">
            <div class="modal-tab active" data-tab="direct" onclick="switchModalTab('direct')">Nouveau Message</div>
            <!-- Création de groupes désactivée - le groupe General est créé automatiquement -->
            <!-- <div class="modal-tab" data-tab="group" onclick="switchModalTab('group')">Nouveau Groupe</div> -->
        </div>

        <!-- TAB: NOUVEAU MESSAGE -->
        <div id="directSection" class="modal-section active">
            <input type="text" class="search-input" id="searchDirect" placeholder="Chercher une personne..." oninput="filterUsers('direct')">
            <div class="user-list" id="directUserList">
                <!-- Les utilisateurs s'ajoutent ici -->
            </div>
        </div>

        <div class="modal-actions">
            <button class="btn-create" onclick="confirmCreateChat()">Créer</button>
            <button class="btn-cancel" onclick="closeModal()">Annuler</button>
        </div>
    </div>
</div>

<script src="../js/chat.js" defer></script>

<!-- FOOTER -->
<footer>
    <p>&copy; 2026 Horizon Café - Tous droits réservés | Conçu avec <i class="fas fa-heart"></i> par l'équipe</p>
</footer>

</body>
</html>
